<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>D2 Edge of Fate Armor Builder</title>
<style>
  body { font-family: Arial, sans-serif; background: #111; color: #eee; padding: 20px; }
  h1 { margin-bottom: 10px; }
  .slider-container { margin-bottom: 20px; }
  .slider-line { display: flex; align-items: center; margin: 6px 0; gap: 10px; }
  input[type=range] { flex: 1; }
  .armor-grid { display: grid; grid-template-columns: repeat(auto-fit,minmax(250px,1fr)); gap: 15px; margin-top: 20px; }
  .slot { border: 1px solid #333; padding: 12px; border-radius: 8px; background: #1b1b1b; display: flex; flex-direction: column; }
  .stat-line { display: flex; justify-content: space-between; margin: 2px 0; }
  .badge { display: inline-block; background: #222; padding: 4px 8px; border-radius: 6px; margin: 2px; font-size: 13px; }
  .stat-breakdown { font-size: 12px; color: #aaa; margin-top: 4px; }
  .slider-bar { height: 8px; background: #333; border-radius: 4px; overflow: hidden; margin-top: 2px; }
  .slider-fill { height: 8px; background: #4caf50; }
</style>
</head>
<body>
<h1>Destiny 2 Edge of Fate Armor Builder</h1>
<div class="slider-container" id="slidersContainer"></div>
<button id="autoCalcBtn">Auto-calc Build</button>
<div style="margin-top:10px;">
  <span id="modsBadge" class="badge">+10 mods needed: 0</span>
</div>
<div id="armorGrid" class="armor-grid"></div>
<script>
const STATS = ['Super','Melee','Grenade','Class','Weapons','Health'];
const MAX_STAT = 200;
const PRIMARY_VAL = 30, SECONDARY_VAL = 25, TERTIARY_VAL = 20, MASTERWORK = 5, PLUS10 = 10;
const armorSlots = ['Helmet','Arms','Chest','Legs','Class Item'];

const ARCHETYPES = [
  {name:'Paragon', primary:0, secondary:1},
  {name:'Grenadier', primary:5, secondary:0},
  {name:'Specialist', primary:2, secondary:3},
  {name:'Brawler', primary:1, secondary:4},
  {name:'Bulwark', primary:4, secondary:2},
  {name:'Gunner', primary:3, secondary:5}
];

let desired = new Array(STATS.length).fill(0);
const sliders = [];

const slidersContainer = document.getElementById('slidersContainer');
STATS.forEach((s,i)=>{
  const div = document.createElement('div'); div.className='slider-line';
  const label = document.createElement('label'); label.textContent = s;
  const slider = document.createElement('input');
  slider.type='range'; slider.min='0'; slider.max=MAX_STAT; slider.value='0';
  const val = document.createElement('span'); val.textContent='0';
  const bar = document.createElement('div'); bar.className='slider-bar';
  const fill = document.createElement('div'); fill.className='slider-fill';
  bar.appendChild(fill);
  slider.oninput = ()=>{
    desired[i] = parseInt(slider.value);
    val.textContent = slider.value;
    fill.style.width = (slider.value/MAX_STAT*100)+'%';
    updateSlidersMax();
  };
  div.appendChild(label); div.appendChild(slider); div.appendChild(val); div.appendChild(bar);
  slidersContainer.appendChild(div);
  sliders.push(slider);
});

const modsBadge = document.getElementById('modsBadge');
const armorGrid = document.getElementById('armorGrid');
const autoCalcBtn = document.getElementById('autoCalcBtn');

function getPieceStats(archIdx, tertiary, mw=MASTERWORK){
  const arch = ARCHETYPES[archIdx];
  let arr = new Array(STATS.length).fill(0);
  arr[arch.primary] += PRIMARY_VAL;
  arr[arch.secondary] += SECONDARY_VAL;
  arr[tertiary] += TERTIARY_VAL;
  for(let s=0;s<STATS.length;s++){
    if(s!==arch.primary && s!==arch.secondary && s!==tertiary) arr[s]+=mw;
  }
  return arr;
}

function evaluateBuild(assign){
  let totals = new Array(STATS.length).fill(0);
  let pieces = [];
  for(let i=0;i<5;i++){
    const archIdx = assign[i];
    const arch = ARCHETYPES[archIdx];
    let deficits = desired.map((d,idx)=>d - totals[idx]);
    let bestT=-1, bestGain=-Infinity;
    for(let s=0;s<STATS.length;s++){
      if(s===arch.primary||s===arch.secondary) continue;
      let gain = deficits[s];
      if(gain>bestGain){bestGain=gain; bestT=s;}
    }
    const stats = getPieceStats(archIdx,bestT);
    totals = totals.map((t,idx)=>t+stats[idx]);
    pieces.push({archIdx,tertiary:bestT,stats});
  }
  let deficits = desired.map((d,idx)=>Math.max(0,d-totals[idx]));
  let modsNeeded = Math.ceil(deficits.reduce((a,b)=>a+b,0)/PLUS10);
  if(modsNeeded>5) modsNeeded=5;
  return {totals,pieces,modsNeeded};
}

function solveBuild(){
  let best=null;
  for(let a0=0;a0<6;a0++) for(let a1=0;a1<6;a1++) for(let a2=0;a2<6;a2++) for(let a3=0;a3<6;a3++) for(let a4=0;a4<6;a4++){
    const assign=[a0,a1,a2,a3,a4];
    const res=evaluateBuild(assign);
    if(!best || res.modsNeeded<best.modsNeeded){best={assign,res};}
  }
  return best.res;
}

function updateArmor(){
  const r=solveBuild();
  armorGrid.innerHTML="";
  modsBadge.textContent=`+10 mods needed: ${r.modsNeeded}`;
  r.pieces.forEach((p,i)=>{
    const arch=ARCHETYPES[p.archIdx];
    const div=document.createElement('div'); div.className='slot';
    div.innerHTML=`<strong>${armorSlots[i]} â€” ${arch.name}</strong>`+
      p.stats.map((v,j)=>`<div class='stat-line'><span>${STATS[j]}</span><span>${v}</span></div>`).join('')+
      `<div class='stat-breakdown'>Base + Masterwork + Mods applied dynamically</div>`;
    armorGrid.appendChild(div);
  });
}

function updateSlidersMax(){
  const r=solveBuild();
  sliders.forEach((s,i)=>{
    s.max = r.totals[i];
  });
}

autoCalcBtn.onclick=()=>{updateArmor(); updateSlidersMax();};
</script>
</body>
</html>
