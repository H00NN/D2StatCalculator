<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Destiny 2 Build Creator (Armor 4.4)</title>
  <style>
    :root{--bg:#0f1020;--card:#191a2e;--muted:#9aa3b2;--ok:#4ade80;--bad:#f87171;--accent:#60a5fa}
    *{box-sizing:border-box}
    body{background:var(--bg);color:#fff;font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Arial,Apple Color Emoji,Segoe UI Emoji;margin:0;padding:24px;position:relative}
    h1{font-size:1.75rem;margin:0 0 8px}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:16px;margin-top:16px}
    .card{background:var(--card);border:1px solid #2b2e55;border-radius:12px;padding:14px;box-shadow:0 2px 8px rgba(0,0,0,.35)}
    label{font-weight:700;display:block;margin-bottom:8px}
    input[type=range]{width:100%}
    .result{margin-top:16px;font-size:1.05rem}
    .ok{color:var(--ok)}.error{color:var(--bad)}
    .pieces{display:grid;grid-template-columns:repeat(auto-fit,minmax(220px,1fr));gap:12px;margin-top:18px}
    .piece{background:#1f2140;border:1px solid #2e315e;border-radius:10px;padding:12px}
    .piece h3{margin:0 0 6px;font-size:1rem}
    .pill{display:inline-block;padding:2px 8px;border-radius:999px;font-size:.8rem;margin-right:6px;border:1px solid #3a3f7a}
    .small{font-size:.85rem;color:var(--muted)}
    .legend{display:flex;gap:6px;flex-wrap:wrap;margin:6px 0}
    .statline{display:flex;justify-content:space-between;font-variant-numeric:tabular-nums;align-items:center;margin-bottom:4px}
    .stat-mod{font-size:.8rem;color:var(--accent);margin-left:6px}
    .footer{margin-top:22px;color:var(--muted);font-size:.9rem}
    .version{position:absolute;top:24px;right:24px;color:var(--muted);font-size:.9rem}
  </style>
</head>
<body>
  <h1>Destiny 2 Build Creator — Armor 4.4</h1>
  <div class="version" id="versionIndicator">v0.34</div>

  <div id="statsContainer" class="grid"></div>
  <div class="result"><p id="feasibility"></p></div>
  <div id="pieces" class="pieces"></div>
  <div class="footer small" id="notes"></div>

<script>
  const STATS = ["Super","Melee","Class","Grenade","Health","Weapons"];
  const ARCHETYPES = [
    {key:"Paragon", primary:"Super", secondary:"Melee"},
    {key:"Grenadier", primary:"Grenade", secondary:"Super"},
    {key:"Specialist", primary:"Class", secondary:"Weapons"},
    {key:"Brawler", primary:"Melee", secondary:"Health"},
    {key:"Bulwark", primary:"Health", secondary:"Class"},
    {key:"Gunner", primary:"Weapons", secondary:"Grenade"}
  ];

  let desired = Object.fromEntries(STATS.map(s=>[s,0]));

  function statObj(fill=0){const o={}; STATS.forEach(s=>o[s]=fill); return o;}

  function pieceDistribution(archetype, tertiary){
    const dist = statObj(0);
    dist[archetype.primary]=30;
    dist[archetype.secondary]=25;
    dist[tertiary]=20;
    STATS.forEach(s=>{ if(s!==archetype.primary && s!==archetype.secondary && s!==tertiary) dist[s]+=5; });
    return dist;
  }

  function maxStatPossible(){ return 200; }

  function planPieces(target){
    let remaining = Object.fromEntries(STATS.map(s=>[s,target[s]]));
    let chosen=[];

    for(let i=0;i<5;i++){
      let best=null, bestScore=-Infinity;
      for(const arch of ARCHETYPES){
        const tertOptions = STATS.filter(s=>s!==arch.primary && s!==arch.secondary);
        for(const t of tertOptions){
          let piece = pieceDistribution(arch,t);
          let score=0; STATS.forEach(s=>{ score+=Math.min(piece[s], remaining[s]); });
          if(score>bestScore){ bestScore=score; best={arch,tertiary:t,piece}; }
        }
      }

      // Assign one +10 stat mod and one +5 stat tuning mod per piece only
      let mod_assignment = STATS.map(s=>({stat:s,value:0, tuning:false, regular:false}));
      let regularAssigned=false, tuningAssigned=false;
      STATS.forEach(s=>{
        if(!regularAssigned && remaining[s]-best.piece[s]>=10){
          mod_assignment.find(m=>m.stat===s).value+=10;
          mod_assignment.find(m=>m.stat===s).regular=true;
          remaining[s]-=10;
          regularAssigned=true;
        }
      });
      STATS.forEach(s=>{
        if(!tuningAssigned && remaining[s]-best.piece[s]>0){
          mod_assignment.find(m=>m.stat===s).value+=5;
          mod_assignment.find(m=>m.stat===s).tuning=true;
          remaining[s]-=5;
          tuningAssigned=true;
        }
      });

      chosen.push({...best, mod_assignment});
      STATS.forEach(s=>{
        remaining[s]-=(best.piece[s]+mod_assignment.find(m=>m.stat===s).value);
        if(remaining[s]<0) remaining[s]=0;
      });
    }

    return {chosen, remaining};
  }

  function renderSliders(){
    const wrap = document.getElementById('statsContainer'); wrap.innerHTML='';
    STATS.forEach(stat=>{
      const card=document.createElement('div'); card.className='card';
      const label=document.createElement('label'); label.textContent=stat;
      const slider=document.createElement('input');
      slider.type='range'; slider.min=0; slider.max=maxStatPossible(); slider.step=5; slider.value=desired[stat];
      const val=document.createElement('span'); val.className='small'; val.style.marginLeft='8px'; val.textContent=desired[stat];
      slider.addEventListener('input', e=>{ desired[stat]=parseInt(e.target.value,10); val.textContent=desired[stat]; recalc(); });
      card.append(label,slider,val); wrap.append(card);
    });
  }

  function recalc(){
    const piecesEl = document.getElementById('pieces'); piecesEl.innerHTML='';
    let plan = planPieces(desired);
    const remainingStats = plan.remaining;
    const impossible = STATS.filter(s=>remainingStats[s]>0);
    const feas = document.getElementById('feasibility');

    if(impossible.length){
      feas.className='error';
      feas.textContent=`⚠️ Stat combination exceeds achievable values: `+impossible.map(s=>`${s} ${remainingStats[s]}`).join(', ');
      document.getElementById('notes').textContent='Adjust desired stats within achievable limits (max 200 per stat).';
    } else {
      feas.className='ok';
      feas.textContent='✅ Achievable with selected archetypes, stat mods, and stat tuning.';
      document.getElementById('notes').textContent='';
    }

    plan.chosen.forEach((c,idx)=>{
      const el=document.createElement('div'); el.className='piece';
      const header=document.createElement('h3'); header.textContent=`Piece ${idx+1}: ${c.arch.key}`;
      const legend=document.createElement('div'); legend.className='legend';
      legend.innerHTML=`<span class="pill">Primary: ${c.arch.primary} +30</span><span class="pill">Secondary: ${c.arch.secondary} +25</span><span class="pill">Tertiary: ${c.tertiary} +20</span>`;
      const table=document.createElement('div'); STATS.forEach(s=>{
        const row=document.createElement('div'); row.className='statline';
        const mod = c.mod_assignment.find(m=>m.stat===s && m.value>0);
        let modText = '';
        if(mod){
          if(mod.regular) modText += 'Equip +10 Mod';
          if(mod.tuning) modText += (modText?' & ':'')+'Stat Tuning +5';
        }
        row.innerHTML=`<span>${s}: ${c.piece[s]}${modText?` (${modText})`:''}</span>`;
        table.appendChild(row);
      });
      el.append(header,legend,table); piecesEl.appendChild(el);
    });
  }

  renderSliders(); recalc();
</script>
</body>
</html>
